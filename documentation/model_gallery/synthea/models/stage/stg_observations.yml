version: 2
models:
- name: stg_observations
  description: The table is about medical observations. It contains date, patient
    ID, encounter ID, category, code, description, value, units, and type of measurement.
    The observations include vital signs like body height, weight, and pain severity.
    Each row represents a single measurement taken for a patient during a specific
    encounter.
  columns:
  - name: observation_category
    description: Classification of the medical observation
    tests:
    - accepted_values:
        values:
        - laboratory
        - survey
        - vital-signs
        - social-history
        - procedure
        - exam
        - therapy
    cocoon_meta:
      missing_reason: Unknown
      future_accepted_values:
      - imaging
      - medication
      - allergy
      - immunization
      - family-history
      - medical-device
      data_type:
        current_data_type: VARCHAR
  - name: observation_code
    description: Standardized code for the observation type
    tests:
    - not_null
    cocoon_meta:
      patterns:
      - regex: \d{4,5}-\d
        summary: Numeric codes with dashes (e.g., 8462-4, 72514-3)
      - regex: '[A-Z]{4}'
        summary: Short alphabetic codes (e.g., DALY, QALY, QOLS)
      - regex: '[A-Z0-9-]{4,8}'
        summary: General pattern to catch most codes
      data_type:
        current_data_type: VARCHAR
  - name: observation_description
    description: Human-readable description of the observation
    tests:
    - not_null
    cocoon_meta:
      patterns:
      - regex: (Systolic|Diastolic) Blood Pressure
        summary: Blood pressure measurements (Systolic and Diastolic)
      - regex: .+ \[Score\] - Reported
        summary: Numeric scale measurements (e.g., Pain severity, PHQ-2 score)
      - regex: Body (Weight|Height|Mass Index)
        summary: Body measurements (Weight, Height, BMI)
      - regex: (Heart|Respiratory) rate
        summary: Vital signs (Heart rate, Respiratory rate)
      - regex: (DALY|QALY|QOLS)
        summary: Quality of life metrics
      - regex: .+ (\[Mass/volume\]|\[Enzymatic activity/volume\]|\[#/volume\]|\[Volume
          Fraction\]|\[Entitic (mass|volume)\]) in .+
        summary: Lab test results
      - regex: Total score \[.+\]
        summary: Questionnaire total scores
      - regex: Are you .+\?
        summary: Yes/No questions
      - regex: What is your .+\?
        summary: Open-ended questions
      data_type:
        current_data_type: VARCHAR
  - name: observation_value
    description: Numeric or categorical result of the observation
    tests:
    - not_null
    cocoon_meta:
      unusal_values: Numeric values are inconsistently represented as strings ('1.0')
        and floats (14.0). Boolean concepts use 'Yes'/'No' and '1.0'/'0.0'.
      patterns:
      - regex: \d+\.\d
        summary: Numeric values with one decimal place
      - regex: ^(Yes|No)$
        summary: Yes/No values
      - regex: ^(Not at all|A little bit|Somewhat|3 to 5 times a week|5 or more times
          a week)$
        summary: Categorical frequency responses
      - regex: .+\s\(finding\)
        summary: Medical findings in parentheses
      - regex: .+\s\(qualifier value\)
        summary: Qualifier values in parentheses
      - regex: ^(Full-time work|Part-time or temporary work)$
        summary: Types of work
      - regex: ^(Private insurance|Medicare|Medicaid)$
        summary: Types of insurance
      - regex: ^(More than high school|High school diploma or GED)$
        summary: Education levels
      - regex: ^I\s.+
        summary: Responses starting with "I"
      - regex: ^\d+\s[A-Za-z\s]+\sUnit\s\d+$
        summary: Street addresses
      data_type:
        current_data_type: VARCHAR
  - name: UNITS
    description: Unit of measurement for the observation
    cocoon_meta:
      missing_reason: Not applicable for non-numeric or unitless observations.
      data_type:
        current_data_type: VARCHAR
  - name: value_type
    description: Data type of the observation value
    tests:
    - not_null
    - accepted_values:
        values:
        - numeric
        - text
    cocoon_meta:
      future_accepted_values:
      - boolean
      - date
      - time
      - datetime
      - categorical
      data_type:
        current_data_type: VARCHAR
  - name: encounter_id
    description: Unique identifier for the medical encounter
    cocoon_meta:
      missing_reason: Unknown
      data_type:
        current_data_type: UUID
  - name: observation_datetime
    description: Timestamp of the medical observation
    tests:
    - not_null
    cocoon_meta:
      data_type:
        current_data_type: TIMESTAMP
  - name: patient_id
    description: Unique identifier for the patient
    tests:
    - not_null
    cocoon_meta:
      data_type:
        current_data_type: UUID
